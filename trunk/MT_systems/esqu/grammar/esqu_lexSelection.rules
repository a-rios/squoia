#
# Rules to solve morphological ambiguity (e.g. es: borracho, de: betrunken/Betrunkener (adj vs noun)
#
# Format:
# source_lemma        target_lemma     k/d     condition            ## comment
#
# condition: if the condition evaluates to true, two actions possible:
# -> k=keep (keep only this option), d=delete  (delete this tranlsation option from output)
# shortnames in conditions:
# my -> this node, parent -> parent node, child -> child node (true if condition is met for at least one child node), 
# rsibling/lsibling -> right/left sibling node (true if condition is met for at least one sibling node to the right/left)
# chunkparent: first ancestor that is a chunk, chunkgrandparent etc.

# IMPORTANT: 
# - if more than one translation option with 'k' for a node evaluates to true, the first one will be used to fill 
#   the attributes of NODE, but the all others that evaluate to true will be kept as SYN nodes!
# - rules are stored in a hash, key is the combination of the source lemma (1st column) and target lemma (2nd column in rules)
#  --> it's not possible to have more than one rule with the same source lemma and the same target lemma!!

#gender related ambiguities
viejo		paya		k	(my.smi=/AQ.F/ && xpath{parent::CHUNK/parent::CHUNK/NODE[@sem="[+Fem]"]}) || my.smi=/NCF/
viejo		machu		k	(my.smi=/AQ.M/ && xpath{parent::CHUNK/parent::CHUNK/NODE[@sem="[+Masc]"]})  || my.smi=/NCM/
viejo		mawk'a		k	!( (my.smi=/AQ.F/ && xpath{parent::CHUNK/parent::CHUNK/NODE[@sem="[+Fem]"]} ) || my.smi=/NCF/) && !((my.smi=/AQ0M/ && xpath{parent::CHUNK/parent::CHUNK/NODE[@sem="[+Masc]"]})  || my.smi=/NCM/)

#vejez: payayay (fem.), machuyay (masc.)
#vejez		paya		k	rsibling.headsmi=/NCF/ && rsibling.type=sp-de
#vejez		machu		k	rsibling.headsmi=/NCM/ && rsibling.type=sp-de

anciano		paya		k	my.smi=/AQ.F/ || xpath{parent::CHUNK/parent::CHUNK/NODE[@sem="[+Fem]"]} 
anciano		machu		k	my.smi=/AQ.M/|| xpath{parent::CHUNK/parent::CHUNK/NODE[@sem="[+Masc]"]}
anciano		yuyaq		k	!(my.smi=/AQ.M/ || xpath{parent::CHUNK/parent::CHUNK/NODE[@sem="[+Masc]"]}) && !(my.smi=/AQ.F/ || xpath{parent::CHUNK/parent::CHUNK/NODE[@sem="[+Fem]"]})

#adolescente-> smi=NCC, need to check if head noun is masc/fem or if used as noun, if fem/masc article present
adolescente	t'asqi		k	xpath{parent::CHUNK/parent::CHUNK/NODE[@sem="[+Fem]"]} || child.smi=/D..F../
adolescente	maqta		k	xpath{parent::CHUNK/parent::CHUNK/NODE[@sem="[+Masc]"]}|| child.smi=/D..M../

chico		wayna		k	my.smi=/NCM/
chico		sipas		k	my.smi=/NCF/
chico		huch'uy		k	my.smi=/AQ/

mozo		sipas		k	my.smi=/NCF/
mozo		wayna		k	my.smi=/NCM/

señor		mama		k	my.smi=/NCF/
señor		wiraqucha	k	my.smi=/NCM/

joven		sipas			k	(my.smi=/AQ/ && xpath{parent::CHUNK/parent::CHUNK/NODE[@sem="[+Fem]"]} ) || (my.smi=/NC/ && child.smi=/D..F../) || (my.smi=/AQ/ && parent.si=atr && xpath{parent::CHUNK/parent::CHUNK[NODE[contains(@verbmi,"Copula")]]/CHUNK[@si="suj"]/NODE[@sem="[+Fem]"]} )
joven		maqt'a,wayna		k	(my.smi=/AQ/ && xpath{parent::CHUNK/parent::CHUNK/NODE[@sem="[+Masc]"]} ) || (my.smi=/NC/ && child.smi=/D..M../) || (my.smi=/AQ/ && parent.si=atr && xpath{parent::CHUNK/parent::CHUNK[NODE[contains(@verbmi,"Copula")]]/CHUNK[@si="suj"]/NODE[@sem="[+Masc]"]} )


mozo		sipas		k	my.smi=/NCF/
mozo		wayna		k	my.smi=/NCM/

# fem/masc: warmi, qhari (human), china/urqu (animals)
# leave for language model
#feminino	warmi	k	-
#feminino	china	k	-
#masculino	qhari	k	-
#masculino	urqu	k	-

#gender distinction in kinship terms
#suegro: kaka, suegra: kisma (de hombre), kiwachi (de mujer): proper nouns..?
suegro		kaka		k	my.smi=/NCM/
suegro		kisma		k	my.smi=/NCF/ && xpath{following-sibling::CHUNK[@type="grup-sp"][NODE[@slem="de" or @slem="del"]]/CHUNK/NODE[starts-with(@smi,"NCM")]}
suegro		kiwachi		k	my.smi=/NCF/ && xpath{following-sibling::CHUNK[@type="grup-sp"][NODE[@slem="de"]]/CHUNK/NODE[starts-with(@smi,"NCF")]}

#cuñada: qhachun, cuñado: qatay
cuñado		qhachun		k	my.smi=/NCF/
cuñado		masa		k	my.smi=/NCM/
concuñado	qhachunmasi	k	my.smi=/NCF/
concuñado	qataymasi	k	my.smi=/NCM/

# hermana: ñaña (de mujer), pana (de hombre) / hermano: tura (de mujer), wawqi (de hombre) 
#(lexicon has 2 separate entries for hermana and hermano, so we need to disambiguate only the gender 
# of the refering person here (only possible with de-pp (la hermana del general..)), but not the gender of the sibling (hermana/hermano))

hermano		ñaña	k	xpath{following-sibling::CHUNK[@type="grup-sp"][NODE[@slem="de"]]/CHUNK/NODE[starts-with(@smi,"NCF")]}
hermano		pana	k	xpath{following-sibling::CHUNK[@type="grup-sp"][NODE[@slem="de" or @slem="del"]]/CHUNK/NODE[starts-with(@smi,"NCM")]}

hermano		tura	k	xpath{following-sibling::CHUNK[@type="grup-sp"][NODE[@slem="de"]]/CHUNK/NODE[starts-with(@smi,"NCF")]}
hermano		wawqi	k	xpath{following-sibling::CHUNK[@type="grup-sp"][NODE[@slem="de" or @slem="del"]]/CHUNK/NODE[starts-with(@smi,"NCM")]}

# hija: (warmi) wawa (de mujer), ususi (de hombre) / hijo: (qhari) wawa (de mujer), churi (de hombre) 
#(lexicon has 2 separate entries for hijo and hija, so we don't need disambiguate only the gender 
# of the refering person, but not the gender of the parent (only possible with de-pp (la hija del general..))

hijo		wawa	k	xpath{following-sibling::CHUNK[@type="grup-sp"][NODE[@slem="de"]]/CHUNK/NODE[starts-with(@smi,"NCF")]}
hijo		ususi	k	xpath{following-sibling::CHUNK[@type="grup-sp"][NODE[@slem="de" or @slem="del"]]/CHUNK/NODE[starts-with(@smi,"NCM")]}

hijo		wawa	k	xpath{following-sibling::CHUNK[@type="grup-sp"][NODE[@slem="de"]]/CHUNK/NODE[starts-with(@smi,"NCF")]}
hijo		churi	k	xpath{following-sibling::CHUNK[@type="grup-sp"][NODE[@slem="de" or @slem="del"]]/CHUNK/NODE[starts-with(@smi,"NCM")]}


# animals that have a feminine form in Spanish: zorro, zorrillo, perro, gato
zorro		china_atuq	k	my.smi=/NCF/
zorro		atuq		k	my.smi=/NCM/
perro		allqu		k	my.smi=/NCF/ && my.preform=/china/
perro		allqu		d	my.smi=/NCM/ && !(my.preform=/china/)
zorrillo	china_añas	k	my.smi=/NCF/
zorrillo	añas		k	my.smi=/NCM/
gato		china_misi	k	my.smi=/NCF/
gato		misi		k	my.smi=/NCM/



# other ambiguities

#alto, suni (altitude), hatun -> height
# leave for language model
#alto	suni	k	-
#alto	hatun	k	-

#edad, mita (era), wata (años),TODO: edad de hielo/piedra/etc 
# TODO: add edad_media to lexicon
edad		mit'a	k	xpath{following-sibling::CHUNK[@type="grup-sp"][NODE[@slem="de"]]/CHUNK/NODE[@slem="hielo" or @slem="bronce" or @slem="piedra"]} || xpath{following-sibling::CHUNK/NODE[@slem="moderno" or @slem="medio"]}
edad		wata	k	!(xpath{following-sibling::CHUNK[@type="grup-sp"][NODE[@slem="de"]]/CHUNK/NODE[@slem="hielo" or @slem="bronce" or @slem="piedra"]} || xpath{following-sibling::CHUNK/NODE[@slem="moderno" or @slem="medio"]})

#falta: hucha (de respeto), pisiy (ausencia), panta (error), estar en falta -> separate entry in lexicon
falta	hucha	k	xpath{following-sibling::CHUNK[@type="grup-sp"][NODE[@slem="de"]]/CHUNK/NODE[@slem="respeto"]}
falta	pisiy	k	xpath{following-sibling::CHUNK[@type="grup-sp"][NODE[@slem="de"]]/CHUNK/NODE[not(@slem="respeto")]}
falta	panta	k	my.smi=/^NC/ && (child.smi=/^DP/ || xpath{descendant::NODE[starts-with(@smi,"PX")]}) && !(xpath{following-sibling::CHUNK[@type="grup-sp"]/NODE[@slem="de"]})

#feraz. Ruruq [-Anim], miraq.[+Anim]
# leave for language model
#feraz	ruru	k	-
#feraz	mira	k	-


#lengua: qallu (de la boca), simi (idioma)
# leave for language model
#lengua	qallu	 -			0.1
#lengua	simi	 sibling.smi=/AQ.+/	0.2

#llama: llama (animal), nina (fuego)
# leave for language model
#llama	llama	k	-
#llama	nina	k	-

# propietario, kaqniyuq, but with sp-de: propietario de algo-> algoyuq
propietario	+Poss		k	xpath{following-sibling::CHUNK[@type="grup-sp"]/NODE[@slem="de"]}
propietario	kaqniyuq	k	!(xpath{following-sibling::CHUNK[@type="grup-sp"]/NODE[@slem="de"]})

# dueño
dueño	unspecified	k		!(xpath{following-sibling::CHUNK[@type="grup-sp"]/NODE[@slem="de"]})
dueño	+Poss		k		xpath{following-sibling::CHUNK[@type="grup-sp"]/NODE[@slem="de"]}

#rico (dinero, poder): qhapaq, (comida) miski
rico		qhapaq		k	!(xpath{parent::CHUNK/parent::CHUNK/NODE[@slem="estar"]} || child.slem=qué )
rico		miski		k	xpath{parent::CHUNK/parent::CHUNK/NODE[@slem="estar"]} || child.slem=qué

#titular de casa -> wasiyuq, titular
#titular		++Poss			d	
#titular		unspecified		k	



   ##########
   # VEBRS  #
   ##########
   
#abochornar, calor-> rupha-, avergonzarse -> p'inqa-
#abochornar	rupha	k	-
#abochornar	p'inqa	k	-

#acertar: watu- (adivinar), chayachi- (el blanco)
# leave for language model
#acertar		watu		k	-
#acertar		chaya		k	-

# acordar: yuyari- (recordar) or kamachinaku- (llegar a un acuerdo)
# if with reflexive + de-obj: yuyari, with direct object: kamachinaku
acordar		yuya	k	xpath{parent::CHUNK/CHUNK[@type="grup-sp" or @type="coor-sp"]/NODE[@slem="de"]} || xpath{parent::CHUNK/CHUNK/NODE[@slem="se" or @slem="me" or @slem="te" or @slem="nos" or @slem="vos"]}
acordar		kama	k	xpath{following-sibling::CHUNK[(@type="sn" or @type="coor-n") and (@si="cd" or @si="cd-a")]/NODE[starts-with(@smi,"N")]}

# conducir pusa- (+Anim), apa- (-Anim)
# leave for language model
#conducir	pusa	k	-
#conducir	apa	k	-

# contar: yupa- (count), willa- (tell)
# leave for language model
#contar		yupa	k	-
#contar		willa	k	-

#deber deuda/algo -> manuka-, deber hacer algo -> obligative
deber	manuka		k	!(xpath{parent::NODE[starts-with(@smi,"V")]})
deber	+Obl		k	xpath{parent::NODE[starts-with(@smi,"V")]}

# encontrar -> without reflexive: tari- (encontrar algo)
# with se +locative: ka- (encontrarse en..), with con or nothing -> tinku (encontrarse con alguien)
encontrar		tari	k	!(xpath{parent::CHUNK/descendant::CHUNK/NODE[@slem="se" or @slem="me" or @slem="te"]})
encontrar		ka	k	xpath{parent::CHUNK/descendant::CHUNK/NODE[@slem="se" or @slem="me" or @slem="te"]} && xpath{parent::CHUNK/child::CHUNK/NODE[@slem="en"]}
encontrar		tinku	k	xpath{parent::CHUNK/descendant::CHUNK/NODE[@slem="se" or @slem="me" or @slem="te"]} && !(xpath{parent::CHUNK/child::CHUNK/NODE[@slem="en"]})

#hacer falta (hacer falta que-> separate entry in lexicon)
# TODO: hacer_falta_que
# le hace falta su mama -> watu-, hace falto trabajo -> pisi-, hace falta que hablemos -> na+kan
hacer_falta	watu	k	xpath{parent::CHUNK[@type="grup-verb" or @type="coor-v"]/CHUNK[(@type="sn" or @type="coor-n") and (@si="cd-a" or @si="cd" or @si="suj")]/NODE[@smi="NP00SP0" or @sem="[+Fem]" or @sem="[+Masc]"]}
hacer_falta	pisi	k	xpath{parent::CHUNK[@type="grup-verb" or @type="coor-v"]/CHUNK[(@type="sn" or @type="coor-n") and @si="cd"]/NODE[starts-with(@smi,"NC") and not(@sem="[+Fem]") and not(@sem="[+Masc]")]}
hacer_falta	ka	k	!(xpath{parent::CHUNK[@type="grup-verb" or @type="coor-v"]/CHUNK[(@type="sn" or @type="coor-n") and (@si="cd-a" or @si="ci" or @si="suj")]/NODE[@smi="NP00SP0"]} || xpath{parent::CHUNK[@type="grup-verb" or @type="coor-v"]/CHUNK[(@type="sn" or @type="coor-n") and @si="cd"]/NODE[starts-with(@smi,"NC")]})

# volver: tukuy/kutiy -> default, ++Autotrs -> with adjective + se (volverse rojo: pukayay), volver a + noun -> kutiy, volver a +infinitive -> ++Rep
# TODO: urgent, löscht alles!!
volver		++Autotrs	d	!(xpath{ancestor::CHUNK[1]/child::CHUNK[@si="cpred"]/NODE[starts-with(@smi, "AQ")] } && xpath{ancestor::CHUNK[1]/child::CHUNK/NODE[@slem="se"]} )
volver		++Rep		k	xpath{parent::NODE[@mi="infinitive"]/descendant::NODE[@slem="a"] }
volver		kuti,tuku,++Autotrs		k	!(xpath{parent::NODE[@mi="infinitive"]/descendant::NODE[@slem="a"]} )


#### HACER/PERMITIR; causative ######

hacer		++Caus	k	xpath{parent::NODE[@mi="infinitive"]}
hacer		rura	k	!(xpath{parent::NODE[@mi="infinitive"]})

permitir		++Caus	k	xpath{parent::NODE[@mi="infinitive"]}
permitir		huñi	k	!(xpath{parent::NODE[@mi="infinitive"]})

##### DAR ######

# dar general
dar	qu	k	!(xpath{following-sibling::CHUNK[contains(@si,"cd")]/NODE[@slem="miedo"]})

# dar miedo
dar	mancha	k	xpath{following-sibling::CHUNK[contains(@si,"cd")]/NODE[@slem="miedo"]}

##### TENER ######

# tener años
tener	ka	d	xpath{following-sibling::CHUNK[contains(@si,"cd")]/NODE[@slem="año"]}

# tener enemistad
tener	awqa	k	xpath{following-sibling::CHUNK[contains(@si,"cd")]/NODE[@slem="enemistad"]}

# tener flojera, pereza
tener	qilla	k	xpath{following-sibling::CHUNK[contains(@si,"cd")]/NODE[@slem="flojera" or @slem="pereza"]}

# tener hambre
tener	mikhunaya	k	xpath{following-sibling::CHUNK[contains(@si,"cd")]/NODE[@slem="hambre"]}

# tener hipo
tener	hik'i	k	xpath{following-sibling::CHUNK[contains(@si,"cd")]/NODE[@slem="hipo"]}

# tener miedo
tener	mancha	k	xpath{following-sibling::CHUNK[contains(@si,"cd")]/NODE[@slem="miedo"]}

# tener pareja
tener	yanacha		k	xpath{following-sibling::CHUNK[contains(@si,"cd")]/NODE[@slem="pareja"]}

# tener pena
tener	llaki	k	xpath{following-sibling::CHUNK[contains(@si,"cd")]/NODE[@slem="pena"]}

# tener sed
tener	ununaya		k	xpath{following-sibling::CHUNK[contains(@si,"cd")]/NODE[@slem="sed"]}

# tener sueño
tener	puñunaya	k	xpath{following-sibling::CHUNK[contains(@si,"cd")]/NODE[@slem="sueño"]}

# tener vergüenza
tener	p'inqa		k	xpath{following-sibling::CHUNK[contains(@si,"cd")]/NODE[@slem="vergüenza"]}

# tener compasión
tener	khuya		k	xpath{following-sibling::CHUNK[contains(@si,"cd")]/NODE[@slem="compasión" or @slem="piedad"]}

# tener fragancia
tener	q'apa		k	xpath{following-sibling::CHUNK[contains(@si,"cd")]/NODE[@slem="fragancia" or @slem="olor"]}

# tener: default, use tene-
tener	unspecified	k	!(xpath{following-sibling::CHUNK[contains(@si,"cd")]/NODE[@slem="fragancia" or @slem="olor" or @slem="compasión" or @slem="piedad" or @slem="vergüenza" or @slem="sueño" or @slem="sed" or @slem="pena" or @slem="pareja" or @slem="miedo" or @slem="hipo" or @slem="hambre" or @slem="flojera" or @slem="pereza" or @slem="enemistad" or @slem="año"]})



  #####################
  # PERSONAL PRONOUNS #
  #####################
  
# usted/ustedes
usted	qam		k	my.sform=usted
usted	qamkuna		k	my.sform=ustedes

# personal pronoun 1.Pl -> if verb is 2 pers: must be 1.pl.excl
# -> 2 > 1.pl cannot be inclusive
# nosotros/as (nos is disambiguated in morphSelection.rules)
nosotros	ñuqayku		k	xpath{ancestor::CHUNK[@type="grup-verb" or @type="coor-v"][1]/child::CHUNK[contains(@si,"cd")]/NODE[contains(@mi,"++2")]} 
